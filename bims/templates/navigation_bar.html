{% load static from staticfiles %}
{% load site %}


<!-- new rbis nabar -->
<nav class="rbis-navbar">
    {% current_domain as domain_name %}
    <a class="navbar-brand bims-title-big" href="{{ domain_name }}/" style="padding-top: 0 !important; padding-bottom: 0 !important;">
        {% if custom_theme.logo %}
            <img src="{{ custom_theme.logo.url }}" height="40" width="50"/>
        {% else %}
            {% if custom_theme.site_name %}{{ custom_theme.site_name }}{% else %}{{ APPLICATION_NAME }}{% endif %}
        {% endif %}
    </a>
    <div class="nav-links">
        <ul>
            <li>
                <a class="nav-link" href="{{ domain_name }}">About</a>
            </li>
            <li>
                <a class="nav-link" href="{{ domain_name }}/map">Map</a>
            </li>
            <li>
                <a class="nav-link" href="{{ domain_name }}">Contact</a>
            </li>
            <li>
                <a class="nav-link" href="{{ domain_name }}">Help</a>
            </li>
            <li>
                <a class="nav-link" href="{{ domain_name }}">Citation</a>
            </li>
        </ul>
   

    {% if request.get_host in domain_name %}
    <div class="nav-user">
        {% if user.is_authenticated %}      
        <p id="toggle-authenticated-navbar">{{ user }} <i class="fa fa-caret-down" aria-hidden="true"></i></p>
        {% else %}
        <ul>
            <li>
                <a class="nav-link" href="/accounts/login/">Login</a>
            </li>
            <li>
                <a class="nav-link" href="/accounts/signup/">Sign Up</a>
            </li>
        </ul>
        {% endif %}
    </div>
    {% endif %}
    </div>

    <span id="toggle-navbar" class="nav-links-toggler-icon"><i class="fa fa-bars" aria-hidden="true"></i></span>

    <div class="small-screen-navbar">
        <span id="toggle-close-navbar" class="nav-links-close-icon"><i class="fa fa-times" aria-hidden="true"></i></span>
         <ul>
            <li>
                <a class="small-screen-nav-link" href="{{ domain_name }}">About</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="{{ domain_name }}/map">Map</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="{{ domain_name }}">Contact</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="{{ domain_name }}">Help</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="{{ domain_name }}">Citation</a>
            </li>
            {% if request.get_host in domain_name %}
                {% if user.is_authenticated %}
                    <li>
                        <a class="small-screen-nav-link" href="/profile/">Profile</a>
                    </li>
                    {% else %}
                    <li>
                        <a class="small-screen-nav-link" href="/accounts/login/">Login</a>
                    </li>
                    <li>
                        <a class="small-screen-nav-link" href="/accounts/signup/">Sign Up</a>
                    </li>
                {% endif %}
            {% endif %}
        </ul>
    </div>


    <div class="authenticated-navbar">
        <span id="toggle-authenticated-close-navbar" class="nav-links-close-icon"><i class="fa fa-times" aria-hidden="true"></i></span>
         <ul>
            <li>
                <a class="small-screen-nav-link" href="/profile/">profile</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/site-visit/list/?&collectors=%5B{{ user.id }}%5D">Site Visits</a>
            </li>
            {% if user.is_staff or user.is_superuser %}
            <li class="nav-indicator">Upload</li>
             <li>
                <a class="small-screen-nav-link" href="/upload-taxa/">Taxonomic Data</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/upload-collections/">Occurrence Data</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/upload-physico-chemical/">Physico-chemical Data</a>
            </li>
            <li class="nav-divider"></li>
            <li>
                <a class="small-screen-nav-link" href="/harvest-collections/">Harvest From GBIF</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/location-site-form/add/">Add Site</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/dashboard-management/">Edit Dashboard</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/taxa-management/">Taxon Management</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/download-request/">Download Requests</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/site-visit/list/?&inReview=True">Validate Records</a>
            </li>
            <li class="nav-divider"></li>
            <li>
                <a class="small-screen-nav-link" href="/admin/">Admin Page</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/cms">Wagtail Admin</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/backups-management">Backups</a>
            </li>
            <li>
                <a class="small-screen-nav-link" href="/summary-report">Summary Report</a>
            </li>
            {% endif %}
            <li class="nav-divider"></li>
            <li>
                <a class="small-screen-nav-link" href="/accounts/logout/">Log Out</a>
            </li>
        </ul>
    </div>
</nav>

<!-- <nav class="navbar navbar-expand-md fixed-top">
    <div class="container">
        {% current_domain as domain_name %}
        <a class="navbar-brand bims-title-big" href="{{ domain_name }}/" style="padding-top: 0 !important; padding-bottom: 0 !important;">
            {% if custom_theme.logo %}
                <img src="{{ custom_theme.logo.url }}" height="35"/>
            {% else %}
                {% if custom_theme.site_name %}{{ custom_theme.site_name }}{% else %}{{ APPLICATION_NAME }}{% endif %}
            {% endif %}
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
                data-target="#navbarCollapse" aria-controls="navbarCollapse"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"><i class="fa fa-bars" aria-hidden="true"></i></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="{{ domain_name }}/map">Explore what is happening</a>
                </li>
                <li class="nav-item active dropdown">
                    <a class="nav-link dropdown-toggle" href="#"
                       id="dropdown01" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">Data</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="{{ domain_name }}/source-references/">Source References</a>
                        <a class="dropdown-item" href="{{ domain_name }}/site-visit/list/">Site Visits</a>
                    </div>
                </li>
                {%  if preferences.SiteSetting.blog_page_link %}
                 <li class="nav-item active">
                    <a class="nav-link" href="{{ preferences.SiteSetting.blog_page_link }}">News</a>
                 </li>
                {% endif %}
                {%  if preferences.SiteSetting.docs_page_link %}
                 <li class="nav-item active">
                    <a class="nav-link" href="{{ preferences.SiteSetting.docs_page_link }}">Docs</a>
                 </li>
                 {% endif %}
                <li class="nav-item active dropdown">
                    <a class="nav-link dropdown-toggle" href="#"
                       id="dropdown01" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">About</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="{{ domain_name }}/contact/">Contact</a>
                        <a class="dropdown-item" href="{{ domain_name }}/pages/about_us/">About Us</a>
                    </div>
                </li>
                {% if custom_theme.menu_items.all %}
                    <li class="nav-item active dropdown">
                        <a class="nav-link dropdown-toggle" href="#"
                           id="dropdown01" data-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">Discover</a>
                        <div class="dropdown-menu" aria-labelledby="dropdown01">
                            {% for menu_item in custom_theme.menu_items.all %}
                                <a class="dropdown-item" href="{{ menu_item.url }}" {% if menu_item.blank_target %}target="_blank"{% endif %}>{{ menu_item.title }}</a>
                            {% endfor %}
                        </div>
                    </li>
                {% endif %} 
            </ul>
        </div>
        {% if request.get_host in domain_name %}
        <div class="navbar-collapse collapse w-50 order-3 dual-collapse2">
            <ul class="navbar-nav ml-auto">
                {% if user.is_authenticated %}
                    <li class="nav-item active dropdown">
                        <a class="nav-link dropdown-toggle" href="#"
                           id="dropdown01" data-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">{{ user.first_name }}</a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdown01">
                            <a class="dropdown-item" href="/profile/">Profile</a>
                            <a class="dropdown-item" href="/site-visit/list/?&collectors=%5B{{ user.id }}%5D">Site Visits</a>
                            <div class="dropdown-divider"></div>
                            {% if user.is_staff or user.is_superuser %}
                                <div class="text-sm">Upload</div>
                                <a class="dropdown-item" href="/upload-taxa/">Taxonomic Data</a>
                                <a class="dropdown-item" href="/upload-collections/">Occurrence Data</a>
                                <a class="dropdown-item" href="/upload-physico-chemical/">Physico-chemical Data</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="/harvest-collections/">Harvest From GBIF</a>
                                <a class="dropdown-item" href="/location-site-form/add/">Add Site</a>
                                <a class="dropdown-item" href="/dashboard-management/">Edit Dashboard</a>
                                <a class="dropdown-item" href="/taxa-management/">Taxon Management</a>
                                <a class="dropdown-item" href="/download-request/">Download Requests</a>
                                <a class="dropdown-item" href="/site-visit/list/?&inReview=True">Validate Records</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="/admin/">Admin Page</a>
                                <a class="dropdown-item" href="/cms">Wagtail Admin</a>
                                <a class="dropdown-item" href="/backups-management">Backups</a>
                                <a class="dropdown-item" href="/summary-report">Summary Report</a>
                            {% endif %}
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="/accounts/logout/">Log Out</a>
                        </div>
                    </li>
                {% else %}
                    <li class="nav-item active">
                        <a class="nav-link" href="/accounts/signup/">Sign Up</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/accounts/login/">Login</a>
                    </li>
                {% endif %}
            </ul>
        </div>
        {% endif %}
    </div>
</nav> -->

<script>

    var dropdownCloseButtons = document.getElementsByClassName("close-dropdown");

    for(var i = 0; i < dropdownCloseButtons.length; i++) {
        dropdownCloseButtons[i].onclick = function () {
            var dropdownMenu = document.getElementsByClassName("dropdown-menu");
            for(var j = 0; j < dropdownMenu.length; j++) {
                dropdownMenu[j].classList.remove("show");
            }
        }
    }

    var uploadUrl = '{{ upload_url }}';
    var extResourceUrl = '{{ ext_resource_url }}';
    var docReportUrl = '{{ doc_report_url }}';
    var contactUrl = '{{ contact_url }}';
    var biblioUrl = '{{ biblio_url }}';
    var profileUrl = '{{ profile_url }}';
    var contributionsUrl = '{{ contributions_url }}';
    var titleAbbr = '{{ title_bims_abbr }}';
    var titleLong = '{{ title_bims_long|safe }}';

    if(uploadUrl !== 'None'){
        var navbarUpload = document.getElementById("navbar-upload");
        if(navbarUpload) {
            navbarUpload.href = uploadUrl;
        }
    }

    if(extResourceUrl !== 'None'){
        var navbarExt = document.getElementById("navbar-ext-resources");
        navbarExt.href = extResourceUrl;
    }

    if(docReportUrl !== 'None'){
        var navbarDoc = document.getElementById("navbar-doc-report");
        navbarDoc.href = docReportUrl;
    }

    if(contactUrl !== 'None'){
        var navbarContact = document.getElementById("navbar-contact");
        navbarContact.href = contactUrl;
    }

    if(biblioUrl !== 'None'){
        var navbarBiblio = document.getElementById("navbar-biblio");
        navbarBiblio.href = biblioUrl;
    }

    if(profileUrl !== 'None'){
        var navbarProfile = document.getElementById("navbar-profile");
        if(navbarProfile) {
            navbarProfile.href = profileUrl;
        }
    }

    if(contributionsUrl !== 'None'){
        var navbarContributions = document.getElementById("navbar-contributions");
        navbarContributions.href = contributionsUrl;
    }

    if(titleAbbr !== 'None'){
        $(".bims-title-big").html(titleAbbr);
    }

    if(titleLong !== 'None'){
        $('.bims-title-acc').html(titleLong);
    }

</script>

<script>
    $(document).ready(function(){
        $("#toggle-navbar").click(function(){
            $(".small-screen-navbar").css("right", "0");
            $(document.body).css("overflow-y", "hidden");
        });
    });

    $(document).ready(function(){
        $("#toggle-close-navbar").click(function(){
            $(".small-screen-navbar").css("right", "-250px");
            $(document.body).css("overflow-y", "auto");
        });
    });
</script>

<script>
    $(document).ready(function(){
        $("#toggle-authenticated-navbar").click(function(){
            $(".authenticated-navbar").css("right", "0");
            $(document.body).css("overflow-y", "hidden");
        });
    });

    $(document).ready(function(){
        $("#toggle-authenticated-close-navbar").click(function(){
            $(".authenticated-navbar").css("right", "-250px");
            $(document.body).css("overflow-y", "auto");
        });
    });
</script>